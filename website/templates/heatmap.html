<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

<style>
  .circle:hover{
    stroke: black;
    stroke-width: 4px;
  }
  .tooltip {
    display: inline;
    position: fixed;
  }
  /* Sticky navbar - toggles between relative and fixed, depending on the scroll position. It is positioned relative until a given offset position is met in the viewport - then it "sticks" in place (like position:fixed). The sticky value is not supported in IE or Edge 15 and earlier versions. However, for these versions the navbar will inherit default position */
  .navbar {
    overflow: hidden;
    background-color: #000000;
    position: sticky;
    position: -webkit-sticky;
    top: 0;
  }

  /* Style the navigation bar links */
  .navbar a {
    float: left;
    display: block;
    color: white;
    text-align: center;
    padding: 14px 20px;
    text-decoration: none;
  }


  /* Right-aligned link */
  .navbar a.right {
    float: right;
  }

  /* Change color on hover */
  .navbar a:hover {
    background-color: #ddd;
    color: black;
  }

  /* Active/current link */
  .navbar a.active {
    background-color: #666;
    color: white;
  }
  </style>



<div class="navbar">
  <a href={{url_for('introduction')}}>Introduction</a>
  <a href={{url_for('metadata')}}>Metadata</a>
  <a href="#" class="active">Word Vector</a>
  <a href={{url_for('conclusion')}}>Conclusion</a>
</div>

<div class="w3-container" id="word_vector_explanation">
  <div class="w3-content" style="max-width:1000px">
    <h5 class="w3-padding-16"><span class="w3-tag w3-wide">Cosine Similarity</span></h5>
    <p>As word vectors are vectors, they can be compared to each other by calculating their cosine similarity. 
      Cosine similarity measure how closely two vectors point towards each other, on a scale from -1 to 1.</p>
    <p>Cosine similarity can be calculated regardless of the number of dimensions a vector has, 
      meaning that they are a useful way to visualize the relationship between word vectors with 200 dimensions.</p>
    <p>By checking the cosine similarity of select words to the word “Stalin” over the five time periods, 
      we can examine how associations with Stalin changed over time in the American press. 
      Below is a heatmap showing the changes in cosine similarity of ten words over time.</p>
  </div>
  <div class="w3-padding-32"></div>
</div>

<div class="w3-container" id="my_dataviz"></div>

<!-- Load color palettes -->
<script src="https://github.com/d3/d3-scale-chromatic/blob/main/src/diverging/RdBu.js"></script>

<script>

    // set the dimensions and margins of the graph
    var margin = {top: 80, right: 25, bottom: 30, left: 350},
      width = 1200- margin.left - margin.right,
      height = 700 - margin.top - margin.bottom;
    
    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz")
    .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");
    
    //Read the data
    d3.csv("static/heatmap.csv", function(data) {
    
      // Labels of row and columns -> unique identifier of the column called 'group' and 'variable'
      var myGroups = d3.map(data, function(d){return d.word;}).keys()
      var myVars = d3.map(data, function(d){return d.period;}).keys()
    
      // Build X scales and axis:
      var x = d3.scaleBand()
        .range([ 0, 800 ])
        .domain(myGroups)
        .padding(0.05);
      svg.append("g")
        .style("font-size", 15)
        .attr("transform", "translate(0," +'-12'+ ")")
        .call(d3.axisBottom(x).tickSize(0))
        .select(".domain").remove()
    
      // Build Y scales and axis:
      var y = d3.scaleBand()
        .range([ height, 0 ])
        .domain(myVars)
        .padding(0.05);
      svg.append("g")
        .style("font-size", 15)
        .call(d3.axisLeft(y).tickSize(0))
        .select(".domain").remove()

      // Build color scale
      var myColor = d3.scaleSequential()
        .interpolator(d3.interpolate("white", "red"))
        .domain([0,.65])
    
      // create a tooltip
      var tooltip = d3.select("#my_dataviz")
        .append("div")
        //.call(d3.axisRight(y).tickSize(0))
        .style("opacity", 0)
        .attr("class", "tooltip")
        .style("background-color", "white")
        .style("border", "solid")
        .style("border-width", "2px")
        .style("border-radius", "5px")
        .style("padding", "5px")
    
      // Three function that change the tooltip when user hover / move / leave a cell
      var mouseover = function(d) {
        tooltip
          .style("opacity", 1)
        d3.select(this)
          .style("stroke", "black")
          .style("opacity", 1)
        console.log(d3.mouse(this))
      }
      var mousemove = function(d) {
        let pos = d3.mouse(this);
        tooltip
          .style("left", (d3.mouse(this)[0]+20) + "px")
          .style("top", (d3.mouse(this)[1]) + "px")
          .html("The cosine similarity of Stalin and <b>" + this.id + "</b> is <b>" + d.value + "</b> <br>for the period <b>" + d.period + "</b>.")
      }
      var mouseleave = function(d) {
        tooltip
          .style("opacity", 0)
        d3.select(this)
          .style("stroke", "none")
          .style("opacity", 0.8)
      }
    
      // add the squares
      var n = 0
      svg.selectAll()
        .data(data, function(d) {return d.word+':'+d.period;})
        .enter()
        .append("rect")
          .attr("x", function(d) { return x(d.word) })
          .attr("y", function(d) { return y(d.period) })
          .attr("rx", 4)
          .attr("ry", 4)
          .attr("width", x.bandwidth() )
          .attr("height", y.bandwidth() )
          .style("fill", function(d) { return myColor(d.value)} )
          .style("stroke-width", 4)
          .style("stroke", "none")
          .style("opacity", 0.8)
          .attr("id", function(d) {return d.word;})
        .on("mouseover", mouseover)
        .on("mousemove", mousemove)
        .on("mouseleave", mouseleave)

      svg.append("text")
        .attr("x", width)
        .attr("y", d[0].period)
        .text("test")
    })
    
    // Add title to graph
    svg.append("text")
            .attr("x", 0)
            .attr("y", -50)
            .attr("text-anchor", "left")
            .style("font-size", "30px")
            .text("Associations with Stalin");
    
    // Add subtitle to graph
    svg.append("text")
            .attr("x", 0)
            .attr("y", -30)
            .attr("text-anchor", "left")
            .style("font-size", "14px")
            .style("fill", "grey")
            .style("max-width", 400)
            .text("Hover over each cell to see exact values");
    
    
    </script>


<div class="w3-container" id="explanation">
  <div class="w3-content" style="max-width:1000px">
    <h5 class="w3-padding-16"><span class="w3-tag w3-wide">Observations</span></h5>
    <p>The ten selected words above work best when considered in pairs:</p>
    <ul>
      <li><b>Dictator, Dictators:</b> During the first period we see that there is a stronger association between these titles and 
        the word Stalin. During the second and third periods, when the Soviets were allied with the United States, 
        the cosine similarity dropped significantly. It then begins to climb back to the original value (dictator especially) in 
        the post war era.</li>
      <li><b>Premier, Ally:</b> These are both descriptors that do not change signifcantly during the different periods. 
        Premier was a general descriptor for the Soviet head of government and it maintains a moderately strong association with Stalin. 
        Despite there being multiple periods where Stalin was an ally of the US, the word has a weak association that stays weak throughout.</li>
      <li><b>Mussolini, Hitler:</b> the two leaders of the Axis powers in Europe, both names maintain a strong association with Stalin 
        throughout (and Mussolini is the word with the highest cosine similarity to Stalin in the first time period). 
        Even after the deaths of both Hitler and Mussolini in 1945, the association between these names do not drop.</li>
      <li><b>Churchill, Roosevelt:</b> In contrast to the Axis powers, the two leaders of the Western Allies initially have a 
        low similarity with Stalin, which grows over time. Roosevelt's peaks around his death in 1945 and then begins to decline again, 
        while Churchill's association continues to grow, and the highest similarity between the two occurs in the last time period.</li>
      <li><b>Lenin, Tito:</b> Two communist leaders whose legacies are tied to Stalin. Lenin, Stalin's predecessor, maintains a strong 
        association which peaks during the middle part of the war. Tito initially begins with a very weak association,
         which sees a meteoric rise during his consolidation of power in Yugoslavia. 
         By the final time period Tito has the highest cosine similarity with Stalin of any word.</li>
    </ul>
    <h5 class="w3-padding-16"><span class="w3-tag w3-wide">Observations</span></h5>
    <p>Comparing the results of each word, one can draw a number of hypotheses as to why. For example, the dip in cosine similarity 
      for "Stalin" and "dictator/dictators" corresponds during the war years where the Soviet Union was an ally of the United States. 
      This could suggest that American newspapers were less inclined to associate Stalin with such negative terms when he was an ally. 
      Of course, if that is the case, one would then need to consider why the association for the word “ally” does not change 
      significantly at all. Did the American public view Stalin as a proper ally? Can the drop in association truly be attributed to 
      the war, or is it something else incidental in nature?
    </p>
    <p>Take also the increasing association with Tito. Once Tito had full control over Yugoslavia, he increasingly ran into conflict with 
      Stalin over the direction of the Communist ideology in Europe. The most dramatic events of this split occurred between 1948 and 
      1953 — one could draw the conclusion that the cosine similarity between the two is so high because the American public was 
      fascinated with their developing relationship. 
      This similarity, however, cannot describe the exact nature of the association between Stalin and Tito. 
      Are they closely associated because Americans viewed them as similar people from the perspective of the United States, 
      or because they were butting heads so often? A cosine similarity cannot reveal this, nor would examining the underlying 
      dimensions. The dimensions of a word vector were trained in an unsupervised manner by Word2Vec, and thus do not represent 
      established semantic qualities that can be analyzed in an easy manner.</p>
    </div>
  <div class="w3-padding-32"></div>
</div>
